osx_image: xcode8.3
sudo: required
dist: trusty
language: c
matrix:
  include:
  - os: osx
  - os: linux
    services: docker
    env: CC=clang CXX=clang++ npm_config_clang=1
    compiler: clang
cache:
  directories:
  - node_modules
  - "$HOME/.electron"
  - "$HOME/.cache/electron-builder"
  - "$HOME/.cache"
addons:
  apt:
    packages:
    - libgnome-keyring-dev
    - icnsutils
before_install:
- mkdir -p /tmp/git-lfs && curl -L https://github.com/github/git-lfs/releases/download/v1.2.1/git-lfs-$([
  "$TRAVIS_OS_NAME" == "linux" ] && echo "linux" || echo "darwin")-amd64-1.2.1.tar.gz
  | tar -xz -C /tmp/git-lfs --strip-components 1 && /tmp/git-lfs/git-lfs pull
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install --no-install-recommends
  -y icnsutils graphicsmagick xz-utils; fi
install:
- nvm install 10
- curl -o- -L https://yarnpkg.com/install.sh | bash
- source ~/.bashrc
- npm install -g xvfb-maybe
- yarn
script:
- |
  if [ "$TRAVIS_OS_NAME" == "linux" ]; then
    docker run --rm \
      --env-file <(env | grep -iE 'DEBUG|NODE_|ELECTRON_|YARN_|NPM_|CI|CIRCLE|TRAVIS|APPVEYOR_|CSC_|_TOKEN|_KEY|AWS_|STRIP|BUILD_') \
      -v ${PWD}:/project \
      -v ~/.cache/electron:/root/.cache/electron \
      -v ~/.cache/electron-builder:/root/.cache/electron-builder \
      electronuserland/builder:wine \
      /bin/bash -c "yarn --link-duplicates --pure-lockfile && yarn release --linux --win"
  else
    yarn release
  fi
before_cache:
  - rm -rf $HOME/.cache/electron-builder/wine

deploy:
  provider: releases
  api_key:
    secure: hbv6bi+zE0cr6gIXVW1EboC6I46sq2PLvCte9oyHZ3tp3pc0g+K6dVT5jHmzEdGyT9iaZhH1fgdqBUR7Uo0K1Nssoc3XF7W5plGJcXAV1whLS5kx4ZwSljR9qFx50CCEX8Q8BSH5oV9brt2wYGnlPj/86vQMjJMv7tENRqJLFBmhDgAc5ev3T5Z2x7v5Kk2iyExmCGiu74dUWnh1UDzkSE+BisqFSz3l++W7N9XOVMy2eb5ZJLl52bgIUQ8KRYOMMZwnfa+hoBNNCMsOvYX4o4DoQaAdZqp1ppW4RBFe/cEMvmqQQZyp23tF3MYN1jK4s+Uw74OzxBUhMTRnAux7n7rRoMNy12mPETYyuLRab7Jygc4Gw/s4ynG1zGHi1dzzW523teME/9tjZ5/qycwhwvuVjpt4ACVaxNdWy9OHhvmLvEqj942F9zju/BVWzPEnKf6/58CKU9vVY6s40GjFs3nRuxor8axDrlNbn3z25MQAHQBY4qWUMHTba4ui+M3FXcS5gbSo9lDMzrlTYx3wqtZVMs5GyE6A3YIDZvrFlmRVmbK+pinXChesh8IQoz6jDxZ0Ui1ubQ/NKyJCC+HQoAQw+HbUojnhUTlaWBRBWgoTv0Shc/5re+r97gWVrqFgi3AkerGN1lANNw9o/rLba1phOvLsft4UaoIjO0klg1I=
  on:
    repo: wuyue92tree/beyondWeb
    tag: true
    all_branches: true
branches:
  except:
  - develop
  - master
